<!DOCTYPE html>
<html>
<head>

    <title>Run a jekyll blog with custom plugins locally using Docker</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/fontawesome-all.css">
    <link rel="stylesheet" href="/css/syntax.css">


    <link rel="icon"
          href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMklEQVQ4jWNYem35f0owwzAygIGBAVUCCx+GSTYArxxVDUDHRMkNLi9QZMDAJ6ShawAAL/7WedGlj7QAAAAASUVORK5CYII="
          type="image/png">

    
    <meta name="article:published_time" content="2018-01-28 00:00:00 +0000">
    
    <meta name="keywords" itemprop="keywords"
          content="software, programming, blog, hleb albau, web, web3, chain, blockchain, p2p, crypto jekyll, github, personal blog, custom gems, docker"/>
    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Run a jekyll blog with custom plugins locally using Docker | Hleb Albau</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Run a jekyll blog with custom plugins locally using Docker" />
<meta name="author" content="Hleb Albau" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Hleb Albau Blog About Software Engineering World" />
<meta property="og:description" content="Hleb Albau Blog About Software Engineering World" />
<link rel="canonical" href="http://hleb-albau.com/run-local-site-copy" />
<meta property="og:url" content="http://hleb-albau.com/run-local-site-copy" />
<meta property="og:site_name" content="Hleb Albau" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-01-28T00:00:00+00:00" />
<meta name="google-site-verification" content="Ub8E4qroihmivg8yC8RPHxoDnJNLvKtub6rz0rFln7Q" />
<script type="application/ld+json">
{"headline":"Run a jekyll blog with custom plugins locally using Docker","dateModified":"2018-01-28T00:00:00+00:00","datePublished":"2018-01-28T00:00:00+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://hleb-albau.com/run-local-site-copy"},"url":"http://hleb-albau.com/run-local-site-copy","author":{"@type":"Person","name":"Hleb Albau"},"description":"Hleb Albau Blog About Software Engineering World","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>

<div class="content">

    <header>
        <a href="/">
            <div class="site-title">Hleb Albau</div>
        </a>
        <div class="contact-list">
            <ul>

                <li><a href="https://blockchair.com/bitcoin/address/1N55PBaxpgpq9dD93rVymigAWAwSz9iFMN"
                       title="Support me">
                    <i class="fab fa-bitcoin fa-2x"></i>
                </a></li>
                <li class="tip-button"><a href="/" onclick="return false"
                                          title="Support me using MetaMask">
                    <i class="fab fa-ethereum fa-2x"></i>
                </a></li>

                <li><a href="/feed.xml" title="Subscribe to my RSS feed">
                    <i class="fas fa-rss fa-2x"></i>
                </a></li>
                <li><a href="https://github.com/hleb-albau" title="Follow me on github">
                    <i class="fab fa-github fa-2x"></i>
                </a></li>
                <li><a href="https://hub.docker.com/u/hlebalbau/" title="Run my containers">
                    <i class="fab fa-docker fa-2x"></i>
                </a></li>
                <li><a href="https://stackoverflow.com/users/2198161/hleb-albau" title="My StackOverflow profile">
                    <i class="fab fa-stack-overflow fa-2x"></i>
                </a></li>
                <li><a href="https://twitter.com/hleb_albau" title="Tweet me">
                    <i class="fab fa-twitter fa-2x"></i>
                </a></li>
                <li><a href="https://t.me/hleb_albau" title="Chat me">
                    <i class="fab fa-telegram-plane fa-2x"></i>
                </a></li>
                <li><a href="mailto:hleb.albau@gmail.com" title="Email me">
                    <i class="fas fa-envelope fa-2x"></i>
                </a></li>

            </ul>
        </div>
    </header>

    <div class="post-title">
    <div class="title">
        <h1>Run a jekyll blog with custom plugins locally using Docker</h1>
        
        <span>
            <time datetime="">
                   January 28, 2018
            </time>
        </span>
        
    </div>
</div>


<h2 id="whats-the-problem-">What’s the problem ?</h2>

<p>Github pages supports only small subset of jekyll gems. In order to enable custom gems, you should build site yourself 
and provide to github “compiled” <strong>_site</strong> folder with ready to serve htmls. 
<a href="http://joshfrankel.me/blog/deploying-a-jekyll-blog-to-github-pages-with-custom-plugins-and-travisci/">Here</a> you can 
find very nice article on how to automatize your build of blog with custom plugins using 
<a href="https://travis-ci.org/">TravisCi</a>. But, how can I test changes locally, before publishing them?</p>

<p>Jekyll is written using ruby language. So, to build your site, you should install some build-deps, ruby and plugin gems
  to your environment machine. But… what if I am not a ruby developer. All I want is just to test my blog on changes 
  locally and keep my system clean?</p>

<h2 id="build-your-site-using-docker">Build your site using Docker</h2>

<p>Let’s use <a href="https://www.docker.com/">Docker</a> as a sandbox for local site assembly. We will use 2 images to speed up 
 serve process. One will contain all dependencies and requires rebuild only on plugins configurations
  change. The second will serve generated site.</p>

<p>The first thing we will do, is to define image, containing all required dependencies.</p>

<div class="language-docker highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># local-dependencies file</span>
<span class="k">FROM</span><span class="s"> ruby:2.5-alpine</span>

<span class="k">RUN </span>apk <span class="nt">--update</span> add <span class="nt">--virtual</span> build_deps build-base ruby-dev libc-dev linux-headers

<span class="k">COPY</span><span class="s"> . /jekyll-build</span>
<span class="k">WORKDIR</span><span class="s"> /jekyll-build</span>

<span class="k">RUN </span>bundle <span class="nb">install</span>
<span class="k">RUN </span>bundle list
</code></pre></div></div>

<p>Within default ruby image we install required dev tools, copy our repo with gem definitions(Gemfile) inside container
 and download listed gems. Now, lets build it.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># context is your git repo with site sources</span>
docker build <span class="nt">-f</span> local-dependencies <span class="nt">-t</span> hleb-albau-local-dependencies <span class="nb">.</span>
</code></pre></div></div>

<p>As a result, your local docker registry will contain image with name <em>hleb-albau-local-dependencies</em>.
 Note: you should rebuild <strong>local-dependencies</strong> image each time you add new jekyll gems</p>

<p>Next step is to define image serving generated site.</p>

<div class="language-docker highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># local-run file</span>
<span class="k">FROM</span><span class="s"> hleb-albau-local-dependencies</span>

<span class="k">WORKDIR</span><span class="s"> /jekyll-build</span>

<span class="k">EXPOSE</span><span class="s"> 4000</span>
<span class="k">CMD</span><span class="s"> jekyll serve -d /_site --watch --force_polling -H 0.0.0.0 -P 4000</span>
</code></pre></div></div>

<p>Here we use previously created image <strong>local-dependencies</strong> as a base image, expose 4000 port and run <code class="highlighter-rouge">jekyll serve</code>
 command. It’s all. Now, we are ready to browser our site on <strong>localhost:4000</strong> using next command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># context is your git repo with site sources  </span>
docker build <span class="nt">-f</span> local-run <span class="nt">-t</span> hleb-albau-local-run <span class="nb">.</span> <span class="se">\</span>
<span class="o">&amp;&amp;</span> docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">-v</span> <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>:/jekyll-build <span class="nt">-p</span> <span class="s2">"4000:4000"</span> hleb-albau-local-run
</code></pre></div></div>

<p>Also, <code class="highlighter-rouge">jekyll serve</code> command regenerates your site on every change you made, so there is no need to restart image. You
 can test your changes on the fly. Happy blogging!</p>

</div>

<script>
    var tipButton = document.querySelector('.tip-button');
    tipButton.addEventListener('click', function () {
        if (typeof web3 === 'undefined') {
            return alert('You need to install MetaMask to use this feature. Or just send tokens to `0xb257A9F61A52D554F00db5994E98769e4DaA7f23` using your favorite signer')
        }
        var user_address = web3.eth.accounts[0];
        if (typeof user_address === 'undefined') {
            return alert('You need to log in MetaMask to use this feature.')
        }
        web3.eth.sendTransaction({
            to: "0xb257A9F61A52D554F00db5994E98769e4DaA7f23",
            from: user_address,
            value: web3.toWei('0.00', 'ether')
        }, function (err, transactionHash) {
            if (err) return alert('Error occurs ;( Thanks for trying out!');
        })
    })
</script>
</body>
</html>
